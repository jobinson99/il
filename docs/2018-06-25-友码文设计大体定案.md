---
layout: post
title: "爱码文设计草案"
date: 2018-06-25 12:27:55 +0800
categories: 说明
tags: [爱码文, 语言设计, 文本]
lastmod: 2018-06-25
---

说明：这是爱码文的设计初步定案。


状态含义： 待完成设计  ●完成 ■待测试 ◆被认领开发中 ★计划


格式后缀：il（i markup language）
可考虑：iml（iml is markup language） imt it(it is text 但it已有 脉冲跟踪系统音乐模块文件 使用)


**设计准则：**

- 参考 markdown，但 取消所有的缩进（比如代码块，列表），双行设计（比如主题），所有结构级的，全部用行首语法表示。
- 参考textile，orgmode 但 避免使用字母做标识。

- 尽可能少的标识符 `# | [ ] { } + - = > * / _ ^ ~ `` 1 2 3 4 5 6 7 8 9 0`

- 尽可能常用功能齐备

- 通用的起始和结束标志
- 要方便的加类名或者识别名
- 要方便的可加扩展，融合了mediawiki的表格语法。

- 20180625 补充规则：既要好认，又要视觉舒服：排除 ``\' @$&% ` 排除单行连续3对[[[]]]


带闭合符号，可方便人和程序做识别，多个嵌套区分方式也较简单。


关于嵌入html代码：
直接嵌入html，仅当普通文本，输出html后会被转码，想要原样输出，需要手动 把例外字符 转义。
如果是在 code里嵌入，不运行。
如果是在 pre里嵌入，根据是否设置 init，决定是否运行。

其他代码类似


## 初步定案：20180622

- 全局使用 []符号，行内代码2对中括号 [[]]，区块代码3对中括号 [[[]]] ``[ ``]
- 行内 使用双符号，不依赖空格，原因：英文常用空格隔开词汇，某个词段要加粗，使用空格区分的话，会把1个单词拆分成3个。中文无此问题。数学公式里，经常会出现多个+-=套用
缺点：常用4个标识累赘了，编辑器不带自动闭合会让人烦

## 大体定案 20180625

- 全局使用 []
- 行内使用 空格+单符号，是否用 行首表达式？ [* content]？ *[content]？这样左右可以不用空格隔开。 起始双符号的好处是容易区分，只要加一个空格，即可使其不起作用。
- sub sup 适应 数学和化学的习惯用法，只要 起始符号+末尾空格？还是 和上面的行内统一风格。


## 行内 （内建实现功能）

常用的：
- 加粗 `[* 加粗]`  输出 `<b>加粗</b>`
- 斜体 `[/ 斜体] `  输出 `<i>斜体</i>`
- 删除线 `[+ 删除线] `  输出 `<s>删除线</s>`
- 下划线 `[_ 下划线] `  输出 `<u>下划线</u>`
- 上标下标 `[^ 上标]  [~ 下标]`   输出 `<sup>上标</sup><sub>下标</sub>`
- 代码  "[= 代码] "    输出 `<code>代码</code>` 
- 行内嵌入其他代码，比如html，当普通文本处理
- 加标志：用于各种自定义  ` [mark | xxx] ` 比如 `<mark></mark>`
- 转义 ` \ `

参考：
- markdown orgmode wiki 需要2个符号标识
- textile 的 `[*文字*]` 需要4个符号标识，另一种方式是左右各一个空格 ` *文字* `
- asciidoc的 ` [效果定义]*文字* ` 比较通用，但需要4个符号标识，可用于自定义样式
- wiki的 代码 {{ }} 代码块 {{{}}}
- restruedtext的  ` \* 文字*\ ` 需要4个符号标识



可考虑设定：

``` shell

未使用
[- ]
[` ] 因为容易和 ' 混淆，排除
|    可考虑用于分隔符或者起始标记
@$%&
{}
,.;' " :


双符号版：优点是单词内 样式，无需拆分单词，缺点是符号多，版面看起来杂乱。

- 加粗 `**加粗**`  输出 `<b>加粗</b>`
- 斜体 `//斜体//`  输出 `<i>斜体</i>`
- 删除线 `++删除线++`  输出 `<s>删除线</s>`
- 下划线 `__下划线__`  输出 `<u>下划线</u>`
- 上标下标 ` ^^上标^^ ~~下标~~ `   输出 `<sup>上标</sup><sub>下标</sub>`
- 代码  " ``代码`` "    输出 `<code>代码</code>` 
- 行内嵌入其他代码，比如html，当普通文本处理
- 加标志：用于各种自定义  ` [mark| xxx] ` 比如 `<mark></mark>`
- 转义 ` \ `



左右空格+单符号版
- 加粗 ` *加粗* `  输出 `<b>加粗</b>`
- 斜体 ` /斜体/ `  输出 `<i>斜体</i>`
- 删除线 ` +删除线+ `  输出 `<s>删除线</s>`
- 下划线 ` _下划线_ `  输出 `<u>下划线</u>`
- 上标下标 ` ^上标^ ～下标～ `   输出 `<sup>上标</sup><sub>下标</sub>`
- 代码  ` \`代码\` `  输出 `<code>代码</code>`
- 行内嵌入其他代码，比如html ——当普通文字处理。
- 加标志：用于各种自定义  ` [mark| xxx] ` 比如 `<mark></mark>`
- 转义 ` \ `

左右可无空格版
[*xxx*]
[/xxx/]
[+xxx+]
[_xxx_]
[-xxx-]  未使用
[=xxx=]  未使用
[^xxx^]
[~xxx~]
[`xxx yyy`]

这种需要输入6次（包括2个空格）
[* : ]
[/ : ]
[` : ]

[* content] 需要输入4次（包括空格），带自动闭合3次
[class class content]  用空格隔开类名，后面内容不允许有空格
[class class : content] 带间隔符
[class class: content] 带间隔符，且少一个空格
[:class :class content] 带标识符，输入更多，但后面内容允许空格


带自动闭合，输入4次，不带5次
{*}[xxx]
带自动闭合，输入3次，不带5次
[*[xxx]]
{*[xxx]}
[*[xxx]]

此种好处是可多种样式互嵌
[[*][xxx]]
[[/][xxx]]

```

自定义行内样式：

有起始和终点标志，可以 **多个 嵌入**。

自定义行内样式和连接统一规则：
- 不显示的在前，显示的在后。
- 内容起始终结标记  多行引用，多行列表

```
[类名 类名: 内容]

输出：
<span class=""></span>
<span id=""></span>
锚点id用 #xxx ???不行，对应的连接也是如此


多种样式嵌入
[类名 类名 类名 : 内容]


内容里面再嵌入更多样式
[类名 类名 : 内容[嵌入类名 : 嵌入内容]内容]

```

可考虑自定义
```
 # # 
[类名| 内容 |]
[类名| 内容  ]
{类名| 内容 }
{类名[ 内容]}
[类名1|类名2| 内容|]
{类名 类名 类名 [内容]}

[类名 类名 | 内容]    优点是输入少了2个符号
[类名 类名 | 内容[嵌入类名 嵌入类名| 内容]内容]
[类名 类名 : 内容]

[[类名][内容]]
[[类名 类名 类名][内容]]   多种样式同时嵌入
[[类名 类名][内容[[类名][内容]]内容]]内容里嵌入更多样式

```

## [TODO]链接 （内建实现功能）

统一起来，外链，脚注，底注都是 链接。统一格式，在输出时才做区分。

- 外部链接 http://www.xxx.com
- 邮件链接 email://xxx@xxx.com
- 直显媒体：图，音频，视频等 http://www.xxx.com/xxx.jpg
- 站内链接  /xxx/
- 文内锚点：底注，边注，尾注 <a href="#xxx">锚点</a>，对应的 <span id="xxx"></span>

统一设定为：
```
[>链接地址 链接名]      输出 <a href="链接地址">连接名</a>

[>http://www.xxx.com xxx]
[>/xxx yyy]                 输出 <a href="/xxx"></a>    和类分不开
[>xxx yyy]                链接，可以和类分开，但多输了一个符号，总共要输入7个符号
[!dir/image.png imagename]   输出 <img alt="yyy" src="xxx">

[<anchor anchorname]     <a href="#xxx"></a>
[#anchor anchor content]  <span id="xxx"></span>
[<1 footnote link]       <a href="#1"></a>
[#1 footnote content]    <span id="1"></span>

```
仍要确认的2个问题：
+ 起首符号后，要不要加空格？
+ 中间要不要间隔符？？


参考：
```
[[链接名|链接地址]]
或
[[#直显媒体名#地址]]
[链接名](链接地址)
[[链接地址][链接名]]    orgmode
```
文内锚点：底注，边注，尾注
```
[[#锚点#|地址]] 内容     输出 <a href="#xxx"></a>
[[#锚点目标#|地址]] 内容   输出 <li id="#xxx"></li>

<<锚点>>
[fn:1] 尾注锚点
[[链接地址][链接名]]    orgmode
```
或 以空格分隔
```
[[http://地址 链接名]]
[[#站内# 话题名]]
[[^引用^ 地址]]
[[!直显媒体名字! 地址]]
```

可考虑：
```
如果编辑器或输入法自带自动符号闭合的话，需要输入3次，移位2次。不带的话，需要6次输入，不需移位。
[[链接地址][链接名]]      输出 <a href="链接地址">连接名</a>

[[http://www.xxx.com][xxx]]
[[/xxx][yyy]]                 输出 <a href="/xxx"></a>    和类分不开
[[>xxx][yyy]]                链接，可以和类分开，但多输了一个符号，总共要输入7个符号
[[dir/image.png][imagename]]   输出 <img alt="yyy" src="xxx">

[[#anchor][anchorname]]     <a href="#xxx"></a>
[[:anchor][anchor content]]  <span id="xxx"></span>
[[#1][footnote link]]       <a href="#1"></a>
[[:1][footnote content]]    <span id="1"></span>


如果编辑器或输入法自带自动符号闭合的话，需要输入2-3次，不需移位。
[链接名| 链接地址]
[连接地址| 名|]


符号可自动闭合的话，需要输入3次，不自动闭合符号的话，需要输入5次。
[地址 : 名]
[类名 : ]
[>链接 : ]    <a href=""></a>
[#引用 : ]    <a href="#xxx"></a>
[^页内连接 : ]   <span id="xxx"><span>
[! : ]            <img alt="" src="">
符号可自动闭合的话，需要输入3次（含空格）
[>link linkname]
[> link linkname] 需要输入4次（含空格）
[> link| linkname]需要输入5磁（含空格）


符号可自动闭合的话，需要2次输入，不自动闭合符号的话，需要输入4次。
{地址}[内容]
[内容](地址)
```

## 区块（内建实现）

标识全部在行首，且无缩进。

### 文档大纲 （内建实现功能）

- 一级 ` #1 `   输出 `<h1></h1>`
- 二级 ` #2 `   输出 `<h2></h2>`
- 三级 ` #3 `
- 四级 ` #4 `
- 五级 ` #5 `
- 六级 ` #6 `

如果带自动编号的标题呢？
```
#1+    h1 编号1    输出 <h1>1. </h1>
#1+    h1 编号2    输出 <h1>2.  </h1>
#1     h1
#1+    h1 编号3
```

参考：textile 优点是固定长度 ` h1. h2. h3 ` 。
不固定长度：markdown ` # ## ### ` orgmode  `* ** *** ` asciidoc ` = == === ` 。


### 段落 （内建实现功能）

空行当分段？ 输出 `<p></p>`

### 分隔线 （内建实现功能）

三短线，输出 `<hr>`

```
===
```

可考虑
```
---   和列表 无序三级 `---` 互斥。
+++   和列表 有序三级 `+++` 互斥。
___   下划线
```

### 列表 （内建实现功能）

行首用 - 或 + 带空格，后跟文字。 `<ul><li> <ol><li>`

```
- 无序
-- 无序二级
+ 有序
++ 有序二级
```

混合

```
- 无序
-+ 无序 有序1
-++ 无序 有序 有序1
--+ 无序 无序 有序1
+ 有序1
++ 有序1 有序1
+- 有序1 无序
+-- 有序1 无序 无序
```

定义类列表？不必！可以在此列表基础上实现。


列表续行：续行不缩进，设置一个起始符和结束符

```
--[ 多行列表开始

另一行

--] 多行列表结束
```

列表中的代码块：代码块不缩进

```
--[ 列表行开始
\`\`\` 代码开始
代码
\`\`\` 代码结束
--]  列表行结束
```


### 引用块 （内建实现功能）
输出 `<blockquote></blockquote>`

```
> 一段引用

>[ 多行引用
引用文
>] 多行引用结束

>> 一段 二级引用

>>[ 多行二级引用开始
引用文
>>] 多行二级引用结束
```

参考：
markdown ` > >>`  比较繁琐，每行首都要加 `>`，
textile 行首 `bq. bq..  p.  ` ，比较灵活。


## [TODO]区块 ```可扩展

标识全部在行首，且无缩进。

[TODO]下面2种，选哪种？全用！！！！

```
=[ 调用插件名 custom xxx yyy :zzz
内容
=]

==[
==]

其实不妨允许无限多=号，至少1个以上，这样编写代码文档时可有效区隔。
======================[
==]

输出
<div id="zzz" class="xxx yyy"></div>

可以多个
```
可加于任何行首？？？

插件名
类
:名
>highlight 是否高亮 默认原样。
>pretty 缩进整理，默认原样。
>init 是否运行，默认原样。


代码块是原样输出
头信息则是全文转码后产生的，前台不可见的。注释则是转码时删除。
其他的 插件，则是要运行的，比如表格、绘图、数学公式等。


可考虑：
```
下面几种视觉效果上比三个中括号[[[]]]舒服点
\``` 缺点是不好认，某些字体容易和 '混淆。

优点是输入少，且和 引用块，列表一致用 []做起始和终点标志
`[ 类名
`]

``[  优点是统一用[]作为起始和终点标志，缺点是多了一对符号。
``]


[|类名:
|]


优点是 全局统一用  [] 作为起始和终点标志
缺点：单行的话，视觉上不算舒服。
[[[ 
]]]

优点：行内插入效果的时候，都是要按shift键
缺点：符号形状复杂，视觉干扰大，不美观，恶心反胃——比如latex数学公式。
{{{ 
}}}

不考虑：
<> 常用于数学，代码
() 因为行内常用

```


### 代码块 （默认内建，但插件实现更多功能）
输出`<pre></pre>`

```
==[ 代码名 是否高亮 是否缩进整理 是否运行
代码
==]
```

默认原样输出，这样就可以嵌入任何代码，不用指定代码名。

需要运行和高亮缩进整理的，插件实现。此部分参考orgmode。

参考：
- markdown gfm 的 ` ``` ~~~ `，orgmode的 `#+BEGIN_SRC elisp`
- textile 的行首 `bc.  p.  ` 或  ` pre. p. `
- wiki `{{{ }}}`


几个问题解决：
- 代码里的引注（常用于代码解读），可设置特定符号，放于行首或行末。
- 若代码里也有 行首为 il的结构性标识符，尤其是和 代码块等同的，可以行首空一格，从而不影响源码的原样保持，又避免被误识别。——不建议用 转义符例外，因为影响到源码的原样保持。



### [TODO]表格（插件实现）

参考 mediawiki的表格语法，本来可以 `[| |]` 但连接用到 `[ | ]` ，尤其是脚注和底注，会混淆？？？


也可沿用代码块设定：

```
==[ table
表格代码
==]
```

可用格式

```
{[  表格开始
|-  表格间分割
|   表格单元内容
]}  表格结束
```

实例
```
{[
| 头1 | 头2|
|-
| 内容1 | 内容2 |
| 内容三
|- 下一行

]}
```

参考：

wiki

```
{|
|-
|}
```

textile
```
|_. head1 |_. head2 |_. head3 |
|/3. rowspan | cell  | cell |
|\2. colspan |
| cell | cell |
```
asciidoc
```
|============================
|1 |2 |3 |4
|5 2.2+|6 .3+|7
|8
|9 2+|10
|============================
```


### 绘图（插件实现）

比如流程图，脑图。

沿用代码块设定，调用相应的插件实现。

```
==[ graphviz
绘图表达式
==]
```

svg，canvas等，也通过调用相关插件实现。


### 数学公式（插件实现）

沿用代码块设定，调用相应的插件实现。

```
==[ math
数学公式
==]
```

tex数学公式，双$$符号作为区隔。


### 文件变量（插件实现）

可自由定义，取代一般markdown文件头的yaml信息。


设计可沿用代码块设定，调用相关插件实现。

```
==[ meta
头信息
==]

输出 <head>……</head>
```

可考虑标识：header


参考 orgmode，如下形式：

```
#+xxx:yyy
#+title:标题
```

### 注释（插件实现）

无输出，或者输出 `<!--  -->`

设计可沿用代码块设定，调用相关插件实现。

```
==[ comment
注释
==]
```

参考： orgmode 注释 `#+begin_example 多段注释 #+end_example`

### 其他结构性文本（插件实现）

设计都可沿用代码块设定，调用相关插件实现。



